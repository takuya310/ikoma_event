<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿé§’å¸‚ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Noto Sans JP for clean Japanese typography -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ (ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“…</text></svg>">

    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8f9fa; /* Clean light gray background */
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Custom Scrollbar for event list */
        .event-list-container::-webkit-scrollbar {
            width: 6px;
        }
        .event-list-container::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .event-list-container::-webkit-scrollbar-thumb {
            background: #d1d5db; 
            border-radius: 10px;
        }

        /* Calendar Grid Transitions */
        .day-cell {
            transition: all 0.2s ease;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .selected-date {
            background-color: #4F46E5; /* Indigo-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.4);
        }

        .today-indicator {
            border: 2px solid #4F46E5;
        }

        .has-event::after {
            content: '';
            display: block;
            width: 4px;
            height: 4px;
            background-color: #EF4444; /* Red-500 */
            border-radius: 50%;
            margin: 2px auto 0;
        }

        .selected-date.has-event::after {
            background-color: white;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden text-gray-800">

    <!-- Header Section -->
    <header class="bg-white shadow-sm z-10 flex-none">
        <div class="max-w-md mx-auto px-4 py-4">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-bold text-gray-800">ç”Ÿé§’å¸‚ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±</h1>
                <button onclick="goToToday()" class="text-sm bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full font-medium hover:bg-indigo-100 transition">
                    ä»Šæ—¥
                </button>
            </div>
            
            <!-- Month Navigation -->
            <div class="flex justify-between items-center">
                <button onclick="changeMonth(-1)" class="p-2 text-gray-400 hover:text-gray-600 focus:outline-none">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <h2 id="currentMonthLabel" class="text-lg font-bold text-gray-700"></h2>
                <button onclick="changeMonth(1)" class="p-2 text-gray-400 hover:text-gray-600 focus:outline-none">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Days of Week -->
            <div class="grid grid-cols-7 text-center mt-4 text-xs font-medium text-gray-400">
                <div class="text-red-400">æ—¥</div>
                <div>æœˆ</div>
                <div>ç«</div>
                <div>æ°´</div>
                <div>æœ¨</div>
                <div>é‡‘</div>
                <div class="text-blue-400">åœŸ</div>
            </div>
        </div>
    </header>

    <!-- Calendar Grid Section -->
    <div class="bg-white flex-none shadow-sm pb-4 rounded-b-3xl z-10 relative">
        <div class="max-w-md mx-auto px-2">
            <div id="calendarGrid" class="grid grid-cols-7 text-center gap-y-2">
                <!-- Days will be injected here -->
            </div>
        </div>
    </div>

    <!-- Events List Section -->
    <div class="flex-1 overflow-hidden bg-gray-50 relative">
        <div class="max-w-md mx-auto h-full flex flex-col">
            <div class="px-4 py-3 flex justify-between items-end">
                <h3 id="selectedDateLabel" class="text-lg font-bold text-gray-800"></h3>
                <span id="eventCountLabel" class="text-xs text-gray-500 font-medium"></span>
            </div>
            
            <div id="eventList" class="event-list-container flex-1 overflow-y-auto px-4 pb-20 space-y-3">
                <!-- Events will be injected here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // --- è¨­å®šãƒ»çŠ¶æ…‹ç®¡ç† ---
        const CONFIG = {
            csvPath: './events.csv' // å®Ÿé‹ç”¨æ™‚ã¯ã“ã“ã«CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã
        };

        let state = {
            currentDate: new Date(),
            selectedDate: new Date(),
            events: [], // CSVã‹ã‚‰ãƒ‘ãƒ¼ã‚¹ã—ãŸå…¨ã‚¤ãƒ™ãƒ³ãƒˆ
            isLoading: true
        };

        // --- ãƒ‡ãƒ¢ç”¨ãƒ‡ãƒ¼ã‚¿ (CSVã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ãŸå ´åˆã«ä½¿ç”¨) ---
        // å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã€Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ç”Ÿæˆã—ãŸCSVã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
        const SAMPLE_CSV_DATA = `é–‹å‚¬æ—¥,é–‹å‚¬æ™‚é–“,ã‚¤ãƒ™ãƒ³ãƒˆå,é–‹å‚¬å ´æ‰€,é–‹å‚¬å ´æ‰€ã®ä½æ‰€,å®šå“¡,è²»ç”¨,æŒã¡ç‰©,ç”³ã—è¾¼ã¿æ–¹æ³•,ã‚¤ãƒ™ãƒ³ãƒˆãƒšãƒ¼ã‚¸URL
2025/12/03,10:00ã€œ12:00,ç”Ÿé§’å±±ãƒã‚¤ã‚­ãƒ³ã‚°,ç”Ÿé§’å±±éº“å…¬åœ’,ç”Ÿé§’å¸‚ä¿µå£ç”º2088,20å,500å††,é£²ã¿ç‰©ãƒ»ã‚¿ã‚ªãƒ«,é›»è©±ç”³è¾¼,https://www.city.ikoma.lg.jp/
2025/12/03,14:00ã€œ16:00,ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ•™å®¤,ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚»ãƒ³ã‚¿ãƒ¼,ç”Ÿé§’å¸‚å…ƒç”º1-1,10å,ç„¡æ–™,ãƒãƒ¼ãƒˆPC,Webç”³è¾¼,https://www.city.ikoma.lg.jp/
2025/12/05,09:00ã€œ11:00,æœå¸‚ï¼ˆé‡èœè²©å£²ï¼‰,é§…å‰åºƒå ´,ç”Ÿé§’å¸‚è°·ç”°ç”º,ãªã—,å®Ÿè²»,ã‚¨ã‚³ãƒãƒƒã‚°,ä¸è¦,https://www.city.ikoma.lg.jp/
2025/12/10,13:00ã€œ15:00,å­è‚²ã¦ç›¸è«‡ä¼š,å¸‚å½¹æ‰€ä¼šè­°å®¤,ç”Ÿé§’å¸‚æ±æ–°ç”º8-38,15çµ„,ç„¡æ–™,æ¯å­æ‰‹å¸³,é›»è©±ç”³è¾¼,https://www.city.ikoma.lg.jp/
2025/12/24,18:00ã€œ20:00,ã‚¯ãƒªã‚¹ãƒã‚¹ã‚³ãƒ³ã‚µãƒ¼ãƒˆ,åŒ—ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚»ãƒ³ã‚¿ãƒ¼,ç”Ÿé§’å¸‚çœŸå¼“,50å,1000å††,ãªã—,ãƒã‚±ãƒƒãƒˆè³¼å…¥,https://www.city.ikoma.lg.jp/`;

        // --- åˆæœŸåŒ– ---
        document.addEventListener('DOMContentLoaded', async () => {
            await loadEvents();
            renderCalendar();
            selectDate(new Date()); // ä»Šæ—¥ã‚’é¸æŠ
        });

        // --- CSVèª­ã¿è¾¼ã¿å‡¦ç† ---
        async function loadEvents() {
            try {
                const response = await fetch(CONFIG.csvPath);
                if (!response.ok) throw new Error("CSV not found");
                const text = await response.text();
                parseCSV(text);
            } catch (e) {
                console.log("CSVèª­ã¿è¾¼ã¿å¤±æ•—ï¼ˆã¾ãŸã¯ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œï¼‰ã€‚ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚", e);
                parseCSV(SAMPLE_CSV_DATA);
            }
        }

        // --- CSVãƒ‘ãƒ¼ã‚¹å‡¦ç† ---
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            
            // ç°¡æ˜“çš„ãªCSVãƒ‘ãƒ¼ã‚¹ (å¼•ç”¨ç¬¦å†…ã®ã‚«ãƒ³ãƒã¯è€ƒæ…®ã—ãªã„ç°¡æ˜“ç‰ˆ)
            // å®Ÿé‹ç”¨ã®ãƒ‡ãƒ¼ã‚¿ãŒè¤‡é›‘ãªå ´åˆã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒª(PapaParseãªã©)æ¨å¥¨
            state.events = lines.slice(1).map(line => {
                // ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã ãŒã€ç©ºè¡Œãªã©ã¯ã‚¹ã‚­ãƒƒãƒ—
                if (!line.trim()) return null;
                
                // ãƒ‡ãƒ¼ã‚¿å†…ã«ã‚«ãƒ³ãƒãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ã‚’è€ƒæ…®ã—ã¦æ­£è¦è¡¨ç¾ã§åˆ†å‰²
                // ä»Šå›ã¯ç°¡æ˜“çš„ã«splitã§å®Ÿè£…ã™ã‚‹ãŒã€å¿…è¦ã«å¿œã˜ã¦å¼·åŒ–ã™ã‚‹
                const values = line.split(',');
                
                // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚° (ãƒ˜ãƒƒãƒ€ãƒ¼é †åºä¾å­˜)
                // 0:é–‹å‚¬æ—¥, 1:æ™‚é–“, 2:ã‚¤ãƒ™ãƒ³ãƒˆå, 3:å ´æ‰€, 4:ä½æ‰€, 5:å®šå“¡, 6:è²»ç”¨, 7:æŒã¡ç‰©, 8:ç”³è¾¼, 9:URL
                return {
                    date: values[0], // YYYY/MM/DDå½¢å¼ã‚’æƒ³å®š
                    time: values[1] || '',
                    title: values[2] || 'åç§°æœªè¨­å®š',
                    location: values[3] || '',
                    address: values[4] || '',
                    capacity: values[5] || '',
                    cost: values[6] || '',
                    items: values[7] || '',
                    apply: values[8] || '',
                    url: values[9] || '#'
                };
            }).filter(e => e !== null);
            
            console.log(`Loaded ${state.events.length} events.`);
        }

        // --- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”» ---
        function renderCalendar() {
            const year = state.currentDate.getFullYear();
            const month = state.currentDate.getMonth();
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ›´æ–°
            document.getElementById('currentMonthLabel').textContent = `${year}å¹´ ${month + 1}æœˆ`;

            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰ã®ç”Ÿæˆ
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            // æœˆã®åˆæ—¥ã®æ›œæ—¥ã¨ã€æœˆã®æ—¥æ•°
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // å‰æœˆã®ç©ºç™½åŸ‹ã‚
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                grid.appendChild(emptyCell);
            }

            // æ—¥ä»˜ã‚»ãƒ«ç”Ÿæˆ
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = formatDateStr(year, month + 1, day);
                const cell = document.createElement('div');
                cell.className = 'day-cell h-10 w-10 mx-auto flex items-center justify-center rounded-full text-sm cursor-pointer hover:bg-gray-100 relative';
                cell.textContent = day;
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                const hasEvent = state.events.some(e => e.date === dateStr);
                if (hasEvent) {
                    cell.classList.add('has-event');
                }

                // ä»Šæ—¥ã®æ—¥ä»˜åˆ¤å®š
                const today = new Date();
                if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                    cell.classList.add('today-indicator', 'font-bold');
                }

                // é¸æŠä¸­åˆ¤å®š
                if (isSameDate(state.selectedDate, new Date(year, month, day))) {
                    cell.classList.add('selected-date');
                    // é¸æŠä¸­ã¯æ–‡å­—è‰²ãŒå¤‰ã‚ã‚‹ã®ã§ãƒãƒ¼ã‚«ãƒ¼ã®è‰²ã‚‚CSSã§åˆ¶å¾¡
                }

                cell.onclick = () => selectDate(new Date(year, month, day));
                grid.appendChild(cell);
            }
        }

        // --- æ—¥ä»˜é¸æŠå‡¦ç† ---
        function selectDate(date) {
            state.selectedDate = date;
            
            // ã‚‚ã—é¸æŠã—ãŸæ—¥ä»˜ãŒç¾åœ¨ã®è¡¨ç¤ºæœˆã¨ç•°ãªã‚‹å ´åˆï¼ˆæœˆã¾ãŸãã®å®Ÿè£…ãªã©ç”¨ï¼‰ã€æœˆã‚’ç§»å‹•ã™ã‚‹
            if (date.getMonth() !== state.currentDate.getMonth()) {
                state.currentDate = new Date(date);
            }
            
            renderCalendar(); // é¸æŠçŠ¶æ…‹ã®æ›´æ–°ã®ãŸã‚å†æç”»
            renderEvents();   // ä¸‹éƒ¨ã®ãƒªã‚¹ãƒˆæ›´æ–°
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆæç”» ---
        function renderEvents() {
            const listContainer = document.getElementById('eventList');
            const dateLabel = document.getElementById('selectedDateLabel');
            const countLabel = document.getElementById('eventCountLabel');
            
            // ãƒ©ãƒ™ãƒ«æ›´æ–°
            const year = state.selectedDate.getFullYear();
            const month = state.selectedDate.getMonth() + 1;
            const day = state.selectedDate.getDate();
            const weekDay = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][state.selectedDate.getDay()];
            
            dateLabel.textContent = `${month}æœˆ${day}æ—¥ (${weekDay})`;

            // ãã®æ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            const targetDateStr = formatDateStr(year, month, day);
            const daysEvents = state.events.filter(e => e.date === targetDateStr);
            
            countLabel.textContent = daysEvents.length > 0 ? `${daysEvents.length}ä»¶ã®ã‚¤ãƒ™ãƒ³ãƒˆ` : 'ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“';

            // ãƒªã‚¹ãƒˆç”Ÿæˆ
            listContainer.innerHTML = '';
            
            if (daysEvents.length === 0) {
                listContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-40 text-gray-400 fade-in">
                        <i class="far fa-calendar-times text-4xl mb-2"></i>
                        <p class="text-sm">äºˆå®šã•ã‚Œã¦ã„ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>
                    </div>
                `;
                return;
            }

            daysEvents.forEach(event => {
                const card = document.createElement('div');
                card.className = 'bg-white p-4 rounded-2xl shadow-sm border border-gray-100 fade-in active:scale-[0.98] transition-transform duration-100';
                
                // ã‚¢ã‚¤ã‚³ãƒ³ã‚’é©å½“ã«å‰²ã‚Šå½“ã¦ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåã«åŸºã¥ã„ã¦å¤‰ãˆã¦ã‚‚è‰¯ã„ï¼‰
                let iconClass = "fa-calendar-check";
                if(event.title.includes("ãƒã‚¤ã‚­ãƒ³ã‚°") || event.title.includes("å¤–")) iconClass = "fa-person-hiking";
                if(event.title.includes("ç›¸è«‡")) iconClass = "fa-comments";
                if(event.title.includes("å­è‚²ã¦") || event.title.includes("å­ä¾›")) iconClass = "fa-child";

                card.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="flex-none w-12 pt-1 text-center">
                            <div class="bg-indigo-50 text-indigo-600 rounded-lg p-2">
                                <i class="fas ${iconClass} text-xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs text-indigo-600 font-bold mb-0.5">${event.time}</p>
                            <h4 class="text-base font-bold text-gray-900 leading-snug mb-2">${event.title}</h4>
                            
                            <div class="space-y-1 text-sm text-gray-600">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-map-marker-alt text-gray-400 w-4 text-center"></i>
                                    <span class="truncate">${event.location}</span>
                                </div>
                                ${event.cost && event.cost !== 'ç„¡æ–™' ? `
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-yen-sign text-gray-400 w-4 text-center"></i>
                                    <span>${event.cost}</span>
                                </div>` : ''}
                            </div>
                            
                            <!-- è©³ç´°ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ç”¨ãƒˆã‚°ãƒ«ï¼ˆç°¡æ˜“ç‰ˆã¨ã—ã¦å¸¸ã«è¡¨ç¤ºã™ã‚‹ã‹ã€ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ã«ã™ã‚‹ï¼‰ -->
                            <div class="mt-3 flex gap-2">
                                <a href="${event.url}" target="_blank" class="flex-1 bg-gray-900 text-white text-center py-2 rounded-lg text-sm font-medium hover:bg-gray-800 transition">
                                    è©³ç´°ã‚’è¦‹ã‚‹ <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                                </a>
                            </div>
                            
                            <!-- è£œè¶³æƒ…å ± (ã‚¿ãƒƒãƒ—ã§å±•é–‹ã™ã‚‹ã‚ˆã†ãªUIã‚‚å¯ã ãŒä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«è¡¨ç¤º) -->
                            <div class="mt-3 pt-3 border-t border-gray-100 text-xs text-gray-500 grid grid-cols-2 gap-2">
                                ${event.capacity ? `<div><span class="font-bold">å®šå“¡:</span> ${event.capacity}</div>` : ''}
                                ${event.items ? `<div><span class="font-bold">æŒç‰©:</span> ${event.items}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                listContainer.appendChild(card);
            });
        }

        // --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---
        function goToToday() {
            state.currentDate = new Date();
            state.selectedDate = new Date();
            renderCalendar();
            selectDate(new Date());
        }

        function changeMonth(delta) {
            state.currentDate.setMonth(state.currentDate.getMonth() + delta);
            renderCalendar();
        }

        function formatDateStr(year, month, day) {
            // CSVã®å½¢å¼ã«åˆã‚ã›ã¦ã‚¼ãƒ­åŸ‹ã‚ (YYYY/MM/DD)
            const m = ('0' + month).slice(-2);
            const d = ('0' + day).slice(-2);
            return `${year}/${m}/${d}`;
        }
        
        function isSameDate(d1, d2) {
            return d1.getFullYear() === d2.getFullYear() &&
                   d1.getMonth() === d2.getMonth() &&
                   d1.getDate() === d2.getDate();
        }

    </script>
</body>
</html>